#!/usr/bin/env bash

function generate_id {
  cat <<EOF
{
  "id":"${1}"
}
EOF
}

function generate_move {
  cat <<EOF
{
  "player": "${1}",
  "position": "${2}"
}
EOF
}

ID=$(uuidgen)
GAME=http://localhost:5000/ttt
MOVES="${GAME}/${ID}/moves"
LAST_MOVE=$(curl -s -H "Content-Type:application/json" --data "$(generate_id ${ID})" "${GAME}")
echo "${LAST_MOVE}"

function move {
  local POSITION=${1}
  local PLAYER=$(echo "${LAST_MOVE}" | jq -r '.game.currentPlayer')
  local MOVE=$(generate_move ${PLAYER} ${POSITION})
  LAST_MOVE=$(curl -s -H "Content-Type:application/json" --data "${MOVE}" "${MOVES}")
  echo "${LAST_MOVE}"
}

for p in $(shuf -e 0 1 2 3 4 5 6 7 8); do
  move "${p}"
done
